{% extends 'base.html' %}
{% load static %}
{% load books_extras %}

{% block title %}{{ book.title | title}} аўдыякніга{% endblock title %}
{% block description %}
  Звесткі пра кнігу «{{book.title}}» {% for author in book.authors.all %}{{ author.name }}{% endfor %}:
  апісанне, спасылкі на розныя крыніцы дзе можна паслухаць кнігу.
{% endblock description %}

{% block css_files %}
    <link rel="stylesheet" href="{% static 'css/book-detail.css' %}">
    <link rel="stylesheet" href="{% static 'css/index.css' %}">
{% endblock css_files %}

{% block content %}
<div class="container" id="books">
    <div class="row">

        <!--Book image-->
        <div class="col-12 col-md-6 col-lg-4">
            {% if book.cover_image %}
                <img class="col-md-6 float-md-start mb-3 mx-4 ms-md-3 photo" src="{{ book.cover_image.url }}" alt="{{ book.title }}">
            {% else %}

                <!--Custom cover for book-->
                <div class="col-md-6 float-md-start mb-3 mx-4 ms-md-3 cover d-flex justify-content-center text-center flex-column photo" style="background-image: url({{ book | colors }});background-repeat:no-repeat;">
                    <div class="col-12 pm-2 upper-half">
                        {% for author in book.authors.all %}{{ author.name }}{% endfor %}
                    </div>
                    <div class="separator"></div>
                    <div class="col-12 lower-half pt-2">
                        {{ book.title }}
                    </div>
                </div>
            {% endif %}
        </div>

        <!--Book details-->
        <div class="col-12 col-md-6 col-lg-8">
            
            <!--Book Title-->
            <h2>{{ book.title }}</h2>

            <!--Book Duration-->
            {% if book.duration_sec %}
                <p>{{ book | duration }}</p>
            {% endif %}

            <!--Authors with check on multiples and gender-->
            <div>
                {% include 'partials/_person.html' with persons=authors multiple='Аўтары' single='Aўтар' gender_variants="ка,"%}
            </div>

            <!--Translators with check on multiples and gender-->
            <div>
                {% include 'partials/_person.html' with persons=translators multiple='Пераклалі' single='Перакла' gender_variants="ла,ў"%}
            </div>

            {% if narrations.count == 1 %}
                <div>
                    {% include 'partials/_person.html' with persons=narrations.first.narrators.all multiple='Агучылі' single='Агучы' gender_variants="ла,ў"%}
                </div>
            {% endif %}
            
            <!--Book description-->
            <div class="my-4">
                <p class="fw-normal">{{ book.description|linebreaks }}</p>
            </div>
            
            <!--Adding Links-->
            {% if narrations.count > 1 %}
                {% for narration in narrations %}
                    <div class="row">
                        {% include 'partials/_link.html' %}
                    </div>
                {% endfor %}
            {% else %}
                <div>
                    <div class="col-12 mt-5">
                        Дзе паслухаць
                    </div>
                    <!--Access to the link type-->
                    {% for link in narrations.first.links.all %}
                        <div class="col-12 mt-2">
                            <a href="{{ link.url }}" class="text-decoration-none link-color d-block">
                                <img class="mx-auto me-3 link-icon" src="{{ link.url_type.icon.url }}" alt="{{ link.url_type.caption }}">{{ link.url_type.caption }}
                            </a>
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
            
            <!--Tags-->
            <div class="row my-4">
                {% for tag in tags %}
                    <div class="col-auto p-1">
                        <a href="{% url 'catalog-for-tag' tag.slug %}" class="btn btn-tag p-2">
                            {{tag}}
                        </a>
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>


{% endblock content %}
